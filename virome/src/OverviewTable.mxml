<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark"
		 xmlns:mx="library://ns.adobe.com/flex/mx" 
		 xmlns:cfservice="services.*"
		 xmlns:component="com.component.*"
		 xmlns:com="com.*"
		 xmlns:local="*"
		 width="100%" height="100%" 
		 creationComplete="onCreationComplete()" xmlns:library="services.library.*"> 
	
	<fx:Script>
		<![CDATA[
			import com.MyUtility;
			import com.component.MyGridItem;
			import com.component.MyGridRow;
			import com.component.MyNumberFormatter;
			
			import mx.collections.ArrayCollection;
			import mx.containers.GridItem;
			import mx.controls.Alert;
			import mx.controls.Text;
			import mx.rpc.events.ResultEvent;
			
			[Bindable] private var _util:MyUtility = new MyUtility();
			[Bindable] public var isPrivate:Boolean = false;

			protected function onCreationComplete():void{
				var libraryIdList:String = '';
				var userId:int = -1;
				
				if (isPrivate && _util.app.cookie != null && _util.app.cookie.USERID != undefined){
					libraryIdList = _util.app.cookie.LIBRARYID;
					userId = _util.app.cookie.USERID;
				}
				
				overviewRequest.token = Library.getServerOverview(userId,libraryIdList,isPrivate);
				
				this.validateNow();
			}
			
			protected function overviewResponse(event:ResultEvent):void{
				var ac:ArrayCollection = event.result as ArrayCollection;
				var nf:MyNumberFormatter = new MyNumberFormatter();
				var nf0:MyNumberFormatter = new MyNumberFormatter();
				var txt:Text;
				var gi:MyGridItem;
				var gr:MyGridRow;
				
				nf0.updatePrecision(0);
				
				for (var i:int=0;i<ac.length; i++){
					var obj:Object = ac.getItemAt(i);
					var idx:int = 0;
					var style:String = "";
					var array_holder:Array = new Array();
					
					array_holder = ["","","","","","","",""];
					
					gr = new MyGridRow();
					
					if (i%2 !=0)
						gr.odd();					

					if (obj.ENVIRONMENT.search(/total/i) >= 0){
						style = "strong";
					}
					
					for (var p:String in obj){
						txt = new Text();
						gi = new MyGridItem();
						
						txt.styleName = style;
						
						if (p.search("ENVIRONMENT") >= 0){
							txt.text = _util.properCase(obj[p]);
						} else if ( p.search("_MB") >= 0) {
							txt.text = nf.format((parseFloat(obj[p]))) + " Mbp";
							txt.setStyle("textAlign","right");
							txt.percentWidth=100;							
						} else {
							txt.text = nf0.format(parseFloat(obj[p]));
							txt.setStyle("textAlign","right");
							txt.percentWidth=100;
						}
						
						gi.addChild(txt);
						
						if (p.search("ENVIRONMENT") >= 0)
							array_holder[0] = gi;
						else if (p.search("NO_LIBS") >= 0)
							array_holder[1] = gi;
						else if (p.search("NO_READS") >= 0)
							array_holder[2] = gi;
						else if (p.search("READ_MB") >= 0)
							array_holder[3] = gi;
						else if (p.search("M_READ_SIZE") >= 0)
							array_holder[4] = gi;
						else if (p.search("NO_ORFS") >= 0)
							array_holder[5] = gi;
						else if (p.search("ORF_MB") >= 0)
							array_holder[6] = gi;
						else if (p.search("M_ORF_SIZE") >= 0)
							array_holder[7] = gi;
					}
					
					for (var j:int=0; j<array_holder.length; j++){
						gr.addChild(array_holder[j]);
					}
					grid.addChild(gr);
				}
			}
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		<library:Library id="Library" showBusyCursor="true" fault="_util.faultHandler(event)"
						   destination="ColdFusion" endpoint="{_util.endpoint}" source="{_util.cfcPath}.Library" />
		<s:CallResponder id="overviewRequest" result="overviewResponse(event)"/>		
	</fx:Declarations>
	
	<mx:Label text="Summary of VIROME metagenomes by Environment" styleName="strong" paddingBottom="10" paddingTop="10"/>
	
	<!--add totals numbers table-->
	<mx:Grid verticalGap="0" id="grid">
		<component:MyGridRow width="100%" height="100%" styleName="odd">
			<component:MyGridItem width="100%" height="100%">
				<mx:Text text="Environment" styleName="strong"/>
			</component:MyGridItem>
			
			<component:MyGridItem width="100%" height="100%">
				<mx:Text text="No. of Library(s)" styleName="strong"/>
			</component:MyGridItem>
			
			<component:MyGridItem width="100%" height="100%">
				<mx:Text text="No. of Reads" styleName="strong"/>
			</component:MyGridItem>				
			<component:MyGridItem width="100%" height="100%">
				<mx:Text text="Mbp of Reads (nt)" styleName="strong"/>
			</component:MyGridItem>				
			<component:MyGridItem width="100%" height="100%">
				<mx:Text text="Mean Read len. (nt)" styleName="strong"/>
			</component:MyGridItem>
			
			<component:MyGridItem width="100%" height="100%">
				<mx:Text text="No. of ORFs" styleName="strong"/>
			</component:MyGridItem>
			<component:MyGridItem width="100%" height="100%">
				<mx:Text text="Mbp of ORFs (nt)" styleName="strong"/>
			</component:MyGridItem>
			<component:MyGridItem width="100%" height="100%">
				<mx:Text text="Mean ORF len. (aa)" styleName="strong"/>
			</component:MyGridItem>
		</component:MyGridRow>			
	</mx:Grid>
</mx:VBox>
